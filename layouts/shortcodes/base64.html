<div class="clean-tool-card">
    <div class="tool-title">Base64 Encoder / Decoder</div>
    
    <textarea id="b64-input" placeholder="請在此輸入文字或是 Base64 編碼..." rows="4"></textarea>
    
    <div class="btn-group">
        <button onclick="actionBase64('encode')" class="primary-btn">⬇️ 編碼 (Encode)</button>
        <button onclick="actionBase64('decode')" class="secondary-btn">⬆️ 解碼 (Decode)</button>
        <button onclick="clearAll()" class="clear-btn">清除</button>
    </div>

    <div id="b64-result-area" class="result-box" style="display: none;">
        <div class="result-label">結果 Result:</div>
        <div id="b64-output" class="hash-code"></div>
        <button onclick="copyB64()" class="copy-btn">複製結果</button>
    </div>
</div>

<style>
    .clean-tool-card {
        background-color: #1d1e20;
        border: 1px solid #333;
        border-radius: 8px;
        padding: 25px;
        margin: 20px 0;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .tool-title { font-size: 1.2rem; font-weight: bold; margin-bottom: 15px; color: #e0e0e0; }
    
    textarea {
        width: 100%;
        background: #2e2e33;
        border: 1px solid #444;
        color: #fff;
        padding: 12px;
        border-radius: 4px;
        font-size: 1rem;
        outline: none;
        resize: vertical;
        box-sizing: border-box;
    }
    textarea:focus { border-color: #666; }

    .btn-group { margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap; }
    
    /* 按鈕樣式 */
    .primary-btn, .secondary-btn, .clear-btn {
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.95rem;
        color: white;
        transition: opacity 0.2s;
    }
    .primary-btn { background-color: #3b82f6; } /* 藍色 */
    .secondary-btn { background-color: #10b981; } /* 綠色 */
    .clear-btn { background-color: #ef4444; } /* 紅色 */
    button:hover { opacity: 0.9; }

    .result-box { margin-top: 20px; padding-top: 20px; border-top: 1px solid #444; }
    .result-label { font-size: 0.85rem; color: #aaa; margin-bottom: 8px; }
    .hash-code {
        background: #111;
        padding: 15px;
        border-radius: 4px;
        font-family: monospace;
        color: #ddd;
        word-break: break-all;
        font-size: 0.9rem;
        white-space: pre-wrap; /* 保留換行 */
    }
    .copy-btn {
        margin-top: 10px; background: transparent; border: 1px solid #555;
        color: #aaa; padding: 5px 12px; border-radius: 4px; cursor: pointer;
    }
    .copy-btn:hover { border-color: #888; color: #fff; }
</style>

<script>
    // ✅ 現代化 Base64 編碼函式 (支援 Unicode / 中文)
    // 使用 TextEncoder/TextDecoder API 取代已棄用的 escape/unescape
    
    function utf8_to_b64(str) {
        // 步驟 1: 將字串轉為 UTF-8 bytes
        const bytes = new TextEncoder().encode(str);
        
        // 步驟 2: 將 bytes 轉為 binary string
        const binString = Array.from(bytes, x => String.fromCodePoint(x)).join("");
        
        // 步驟 3: 使用 btoa 轉為 Base64
        return btoa(binString);
    }

    function b64_to_utf8(str) {
        // 步驟 1: Base64 解碼為 binary string
        const binString = atob(str);
        
        // 步驟 2: binary string 轉為 Uint8Array
        const bytes = Uint8Array.from(binString, m => m.codePointAt(0));
        
        // 步驟 3: 使用 TextDecoder 解碼為 UTF-8 字串
        return new TextDecoder().decode(bytes);
    }

    function actionBase64(type) {
        const input = document.getElementById('b64-input').value;
        const outputDiv = document.getElementById('b64-output');
        const resultArea = document.getElementById('b64-result-area');
        
        if (!input.trim()) return;

        try {
            let result = "";
            if (type === 'encode') {
                result = utf8_to_b64(input);
            } else {
                result = b64_to_utf8(input);
            }
            outputDiv.style.color = "#ddd";
            outputDiv.innerText = result;
            resultArea.style.display = 'block';
        } catch (e) {
            // 友善的錯誤訊息
            outputDiv.style.color = "#ff4444";
            outputDiv.innerHTML = `
❌ <strong>解碼失敗</strong><br><br>
<span style="color:#aaa">可能原因：</span><br>
• 輸入不是有效的 Base64 格式<br>
• 字串包含非法字元 (需為 A-Z, a-z, 0-9, +, /, =)<br>
<br>
<span style="color:#666; font-size:0.85rem">Error: ${e.message}</span>
            `.trim();
            resultArea.style.display = 'block';
        }
    }

    function clearAll() {
        document.getElementById('b64-input').value = '';
        document.getElementById('b64-result-area').style.display = 'none';
    }

    function copyB64() {
        const text = document.getElementById('b64-output').innerText;
        navigator.clipboard.writeText(text).then(() => {
            const btn = document.querySelector('.copy-btn');
            const originalText = btn.innerText;
            btn.innerText = "已複製！";
            setTimeout(() => btn.innerText = originalText, 1000);
        });
    }
</script>